<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‰å›½å†°æ²³Â·æç®€è·‘å•†è®¡ç®—å™¨</title>
    <style>
        :root { --primary: #2575fc; --bg: #f5f5f5; --text: #333; --success: #2e7d32; --danger: #d32f2f; --warn: #f57c00; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        .container { max-width: 100%; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; }
        h1 { text-align: center; padding: 15px; background: linear-gradient(135deg, #6a11cb, #2575fc); color: #fff; margin: 0; font-size: 18px; letter-spacing: 1px; }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 10px 8px; text-align: center; border-bottom: 1px solid #eee; font-size: 13px; white-space: nowrap; }
        th { background: #f8f9fa; font-weight: 600; color: #555; position: sticky; top: 0; z-index: 10; }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; text-align: center; transition: all 0.2s; }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(37,117,252,0.15); background: #fff; }
        input[readonly] { background: #f0f2f5; color: #666; cursor: not-allowed; border-color: #eee; }
        
        /* ä¸‹æ‹‰æœç´¢ç»„ä»¶ */
        .custom-select-wrapper { position: relative; width: 140px; margin: 0 auto; }
        .custom-select-input { cursor: text; background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 10px center; padding-right: 25px; text-align: left; }
        .custom-options { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid var(--primary); border-top: 0; max-height: 250px; overflow-y: auto; z-index: 1000; box-shadow: 0 8px 16px rgba(0,0,0,0.15); border-radius: 0 0 6px 6px; display: none; }
        .custom-select-wrapper.open .custom-options { display: block; }
        .custom-option { padding: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left; }
        .custom-option:hover { background: #eef2ff; color: var(--primary); }
        .weight-tag { font-size: 11px; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; }
        .no-results { padding: 10px; text-align: center; color: #999; font-style: italic; display: none; }

        /* æ•°æ®å•å…ƒæ ¼æ ·å¼ */
        .profit-cell { font-weight: bold; font-size: 14px; color: var(--success); }
        .loss { color: var(--danger); }
        .rate-cell { font-size: 12px; color: #666; }
        .rate-high { color: var(--success); font-weight: bold; }
        .rate-low { color: var(--warn); }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn-add { background: var(--primary); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin: 15px auto; display: block; box-shadow: 0 4px 6px rgba(37,117,252,0.2); transition: transform 0.1s; }
        .btn-add:active { transform: scale(0.98); }
        .btn-del { background: #ffebee; color: var(--danger); border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background 0.2s; }
        .btn-del:hover { background: #ffcdd2; }
        
        .footer { text-align: center; padding: 15px; font-size: 12px; color: #888; background: #fafafa; border-top: 1px solid #eee; }
        .note { background: #e3f2fd; color: #1565c0; padding: 10px; font-size: 12px; text-align: center; border-bottom: 1px solid #bbdefb; }
        
        /* åˆè®¡æ  */
        .summary-bar {
            background: #fff;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            border-top: 2px solid #f0f0f0;
            font-size: 14px;
        }
        .summary-item strong { display: block; font-size: 16px; margin-top: 4px; }
        .sum-profit { color: var(--success); }
        .sum-cost { color: var(--text); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§Š ä¸‰å›½å†°æ²³Â·æç®€è·‘å•†è®¡ç®—å™¨</h1>
        <div class="note">ğŸ’¡ æç¤ºï¼šè¾“å…¥æ‹¼éŸ³é¦–å­—æ¯å¿«é€Ÿæœç´¢ (å¦‚ "tks"=é“œçŸ¿çŸ³)ã€‚è‡ªåŠ¨è®¡ç®—æ€»æˆæœ¬å’Œåˆ©æ¶¦ç‡ã€‚</div>
        
        <div class="table-wrapper">
            <table id="tradingTable">
                <thead>
                    <tr>
                        <th style="width: 18%;">å•†å“</th>
                        <th style="width: 12%;">ä¹°å…¥ä»·</th>
                        <th style="width: 12%;">å–å‡ºä»·</th>
                        <th style="width: 12%;">æ•°é‡</th>
                        <th style="width: 12%;">æ€»æˆæœ¬</th>
                        <th style="width: 12%;">åˆ©æ¶¦ç‡</th>
                        <th style="width: 14%;">å‡€åˆ©æ¶¦</th>
                        <th style="width: 8%;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="summary-bar">
            <div class="summary-item">æ€»æˆæœ¬<strong class="sum-cost" id="totalCost">0</strong></div>
            <div class="summary-item">æ€»åˆ©æ¶¦<strong class="sum-profit" id="totalProfit">0</strong></div>
        </div>

        <button class="btn-add" onclick="addRow()">+ æ·»åŠ ä¸€è¡Œ</button>
        <div class="footer">æ•°æ®ä»…ä¾›è§„åˆ’å‚è€ƒï¼Œå®é™…äº¤æ˜“è¯·ä»¥æ¸¸æˆå†…ä¸ºå‡†</div>
    </div>

    <script>
        // å•†å“æ•°æ®åº“
        const products = [
            {n:"é»åœŸ",w:15,p:"nian tu"}, {n:"æ£‰èŠ±",w:13,p:"mian hua"}, {n:"èŒ¶å¶",w:13,p:"cha ye"},
            {n:"é“çŸ¿çŸ³",w:34,p:"tie kuang shi"}, {n:"é“œçŸ¿çŸ³",w:35,p:"tong kuang shi"}, {n:"è°·ç‰©",w:10,p:"gu wu"},
            {n:"è‘¡è„",w:10,p:"pu tao"}, {n:"ç¡¬æœ¨",w:15,p:"ying mu"}, {n:"è¯æ",w:11,p:"yao cai"},
            {n:"é¦™æ–™",w:10,p:"xiang liao"}, {n:"æ¯›çš®",w:18,p:"mao pi"}, {n:"èœ‚èœœ",w:29,p:"feng mi"},
            {n:"ç›",w:35,p:"yan"}, {n:"ç±³é…’",w:30,p:"mi jiu"}, {n:"é™¶å™¨",w:30,p:"tao qi"},
            {n:"è‘¡è„é…’",w:30,p:"pu tao jiu"}, {n:"å…µå™¨",w:52,p:"bing qi"}, {n:"é“œå™¨",w:55,p:"tong qi"},
            {n:"å·¥å…·",w:50,p:"gong ju"}, {n:"å¸ƒå¸›",w:16,p:"bu bo"}, {n:"èœ€é”¦",w:10,p:"shu jin"},
            {n:"æ¼†å™¨",w:32,p:"qi qi"}, {n:"ç‰å™¨",w:32,p:"yu qi"}, {n:"æµ·å—çç ",w:12,p:"hai nan zhen zhu"},
            {n:"é‡‘é“¶å™¨",w:27,p:"jin yin qi"}
        ];

        window.onload = () => {
            addRow("è°·ç‰©", 14.1, 17.6, 100); 
            addRow("èŒ¶å¶", 58.4, 73.1, 50);
            updateSummary();
        };

        function addRow(defName="", buy="", sell="", qty="") {
            const tbody = document.querySelector('#tradingTable tbody');
            const tr = document.createElement('tr');
            
            tr.innerHTML = `
                <td>
                    <div class="custom-select-wrapper" data-def="${defName}">
                        <input type="text" class="custom-select-input" placeholder="æœå•†å“..." autocomplete="off">
                        <div class="custom-options"></div>
                    </div>
                </td>
                <td><input type="number" class="buy-price" value="${buy}" step="0.1" placeholder="0"></td>
                <td><input type="number" class="sell-price" value="${sell}" step="0.1" placeholder="0"></td>
                <td><input type="number" class="plan-qty" value="${qty}" step="1" placeholder="0"></td>
                <td><input type="text" class="cost-display" readonly value="0"></td>
                <td><div class="rate-cell">-</div></td>
                <td><div class="profit-cell">0.00</div></td>
                <td><button class="btn-del" onclick="removeRow(this)">Ã—</button></td>
            `;
            tbody.appendChild(tr);
            
            initSelect(tr.querySelector('.custom-select-wrapper'));
            
            if(defName) setTimeout(()=>{
                const inp = tr.querySelector('.custom-select-input');
                inp.value = defName;
                selectOpt(tr.querySelector('.custom-select-wrapper'), defName, true);
            }, 0);
            
            // ç»‘å®šè¾“å…¥äº‹ä»¶
            tr.querySelectorAll('input').forEach(i => {
                i.addEventListener('input', () => {
                    calcRow(tr);
                    updateSummary();
                });
            });
            
            calcRow(tr);
        }

        function removeRow(btn) {
            const rows = document.querySelectorAll('#tradingTable tbody tr');
            if (rows.length > 1) {
                btn.closest('tr').remove();
                updateSummary();
            } else {
                // å¦‚æœåªå‰©ä¸€è¡Œï¼Œæ¸…ç©ºæ•°æ®è€Œä¸æ˜¯åˆ é™¤
                const row = btn.closest('tr');
                row.querySelectorAll('input').forEach(i => {
                    if(!i.readOnly) i.value = '';
                    if(i.classList.contains('custom-select-input')) i.value = '';
                });
                calcRow(row);
                updateSummary();
            }
        }

        function initSelect(wrap) {
            const inp = wrap.querySelector('.custom-select-input');
            const optsDiv = wrap.querySelector('.custom-options');
            const row = wrap.closest('tr');
            
            products.forEach(prod => {
                const d = document.createElement('div');
                d.className = 'custom-option';
                d.innerHTML = `<span>${prod.n}</span><span class="weight-tag">${prod.w}</span>`;
                d.dataset.v = prod.n;
                d.dataset.p = prod.p;
                optsDiv.appendChild(d);
            });
            
            const noRes = document.createElement('div'); 
            noRes.className='no-results'; 
            noRes.textContent='æ— åŒ¹é…å•†å“'; 
            optsDiv.appendChild(noRes);

            inp.addEventListener('focus', e => { 
                e.stopPropagation(); 
                closeAll(); 
                wrap.classList.add('open'); 
                filter(inp.value, optsDiv, noRes); 
            });
            inp.addEventListener('input', e => { 
                e.stopPropagation(); 
                wrap.classList.add('open'); 
                filter(inp.value, optsDiv, noRes); 
            });
            
            optsDiv.addEventListener('mousedown', e => {
                e.preventDefault();
                const t = e.target.classList.contains('custom-option') ? e.target : e.target.parentElement;
                if(t.classList.contains('custom-option')) {
                    selectOpt(wrap, t.dataset.v, true);
                    calcRow(row);
                    updateSummary();
                }
            });
            
            document.addEventListener('click', e => { 
                if(!wrap.contains(e.target)) wrap.classList.remove('open'); 
            });
        }

        function filter(q, container, noRes) {
            const qs = q.toLowerCase().trim();
            let has = false;
            container.querySelectorAll('.custom-option').forEach(opt => {
                const n = opt.dataset.v, p = opt.dataset.p;
                const match = n.includes(qs) || p.replace(/\s/g,'').includes(qs) || p.split(' ').map(x=>x[0]).join('').includes(qs);
                opt.style.display = match ? 'flex' : 'none';
                if(match) has = true;
            });
            noRes.style.display = has ? 'none' : 'block';
        }

        function selectOpt(wrap, val, force) {
            const inp = wrap.querySelector('.custom-select-input');
            inp.value = val; 
            wrap.classList.remove('open');
            wrap.querySelectorAll('.custom-option').forEach(o => {
                o.classList.toggle('selected', o.dataset.v === val);
            });
        }

        function closeAll() { 
            document.querySelectorAll('.custom-select-wrapper').forEach(w => w.classList.remove('open')); 
        }

        function calcRow(row) {
            const buy = parseFloat(row.querySelector('.buy-price').value) || 0;
            const sell = parseFloat(row.querySelector('.sell-price').value) || 0;
            const qty = parseInt(row.querySelector('.plan-qty').value) || 0;
            
            const cost = buy * qty;
            const profit = (sell - buy) * qty;
            const rate = cost > 0 ? (profit / cost) * 100 : 0;
            
            row.querySelector('.cost-display').value = cost.toLocaleString('zh-CN', {maximumFractionDigits: 1});
            
            const profitCell = row.querySelector('.profit-cell');
            profitCell.textContent = profit.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            profitCell.className = 'profit-cell ' + (profit >= 0 ? '' : 'loss');
            
            const rateCell = row.querySelector('.rate-cell');
            rateCell.textContent = rate.toFixed(1) + '%';
            rateCell.className = 'rate-cell ' + (rate >= 20 ? 'rate-high' : (rate < 0 ? 'loss' : 'rate-low'));
        }

        function updateSummary() {
            let totalCost = 0;
            let totalProfit = 0;
            
            document.querySelectorAll('#tradingTable tbody tr').forEach(row => {
                const buy = parseFloat(row.querySelector('.buy-price').value) || 0;
                const sell = parseFloat(row.querySelector('.sell-price').value) || 0;
                const qty = parseInt(row.querySelector('.plan-qty').value) || 0;
                
                totalCost += buy * qty;
                totalProfit += (sell - buy) * qty;
            });
            
            document.getElementById('totalCost').textContent = totalCost.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            const profitEl = document.getElementById('totalProfit');
            profitEl.textContent = totalProfit.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            profitEl.style.color = totalProfit >= 0 ? 'var(--success)' : 'var(--danger)';
        }
    </script>
</body>
</html>
